<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Are You Smarter Than a 5th Grader - Gameboard</title>
  <style>
    :root {
      color-scheme: dark;
      --board-green: #0f3d2e;
      --board-dark: #0a2a20;
      --chalk: #f4f1e8;
      --chalk-muted: rgba(244, 241, 232, 0.7);
      --chalk-faint: rgba(244, 241, 232, 0.45);
      --accent: #cbdcce;
      --pill-used: rgba(244, 241, 232, 0.2);
      --pill-bg: rgba(15, 61, 46, 0.85);
      --danger: #ffb3b3;
      --success: #b7f5c2;
      --chalk-shadow: 0 2px 0 rgba(0, 0, 0, 0.45);
      --board-grid: rgba(244, 241, 232, 0.05);
      --board-smudge: rgba(244, 241, 232, 0.08);
      --grade-1: linear-gradient(135deg, rgba(44, 140, 70, 0.9), rgba(28, 90, 52, 0.9));
      --grade-2: linear-gradient(135deg, rgba(118, 38, 50, 0.9), rgba(86, 22, 33, 0.9));
      --grade-3: linear-gradient(135deg, rgba(38, 91, 151, 0.9), rgba(26, 62, 107, 0.9));
      --grade-4: linear-gradient(135deg, rgba(166, 150, 64, 0.9), rgba(120, 106, 39, 0.9));
      --grade-5: linear-gradient(135deg, rgba(180, 70, 46, 0.9), rgba(132, 44, 30, 0.9));
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Comic Sans MS", "Trebuchet MS", "Segoe UI", "Gill Sans", sans-serif;
      background: var(--board-green);
      color: var(--chalk);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 16px 18px 28px;
      background-image:
        linear-gradient(0deg, var(--board-grid) 1px, transparent 1px),
        linear-gradient(90deg, var(--board-grid) 1px, transparent 1px),
        radial-gradient(rgba(244, 241, 232, 0.1) 1px, transparent 1px),
        radial-gradient(var(--board-smudge) 1px, transparent 1px);
      background-size: 36px 36px, 36px 36px, 4px 4px, 12px 12px;
      background-position: 0 0, 0 0, 1px 1px, 5px 5px;
    }

    header {
      width: min(1200px, 100%);
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 10px;
    }

    .top-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 14px;
      align-items: center;
    }

    .title {
      font-size: clamp(1.6rem, 2.2vw, 2.5rem);
      letter-spacing: 1px;
      font-weight: 700;
      text-shadow: var(--chalk-shadow);
    }

    .subheader {
      font-size: 0.95rem;
      color: var(--chalk-faint);
      letter-spacing: 0.5px;
      text-transform: uppercase;
      margin-top: 6px;
    }

    .round-select {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    select,
    button {
      font: inherit;
    }

    select {
      background: var(--board-dark);
      color: var(--chalk);
      border: 1px solid var(--chalk-faint);
      padding: 6px 10px;
      border-radius: 6px;
      min-width: 180px;
    }

    .banner {
      font-size: clamp(1rem, 1.6vw, 1.4rem);
      color: var(--chalk-muted);
      margin-top: -4px;
    }

    .content {
      width: min(1200px, 100%);
      display: grid;
      grid-template-columns: minmax(260px, 1fr) 2fr;
      gap: 16px;
      align-items: start;
    }

    .scoreboard {
      background: rgba(10, 42, 32, 0.75);
      border: 1px solid var(--chalk-faint);
      border-radius: 12px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .score-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .scores {
      display: grid;
      gap: 8px;
    }

    .score-card {
      border: 1px solid var(--chalk-faint);
      border-radius: 10px;
      padding: 10px 12px;
      display: grid;
      gap: 6px;
    }

    .team-name {
      font-size: 1.1rem;
      font-weight: 700;
      text-shadow: var(--chalk-shadow);
    }

    .team-score {
      font-size: 1.6rem;
      letter-spacing: 1px;
      text-shadow: var(--chalk-shadow);
    }

    .lifelines {
      display: grid;
      gap: 6px;
      font-size: 0.95rem;
    }

    .lifeline-row {
      display: grid;
      grid-template-columns: auto 1fr auto auto;
      gap: 6px;
      align-items: center;
    }

    .lifeline-row span {
      color: var(--chalk-muted);
      font-size: 0.85rem;
    }

    .small-btn {
      background: transparent;
      border: 1px solid var(--chalk-faint);
      color: var(--chalk);
      padding: 2px 6px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .small-btn:disabled {
      opacity: 0.35;
      cursor: not-allowed;
    }

    .timer {
      text-align: center;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid var(--chalk-faint);
      background: rgba(15, 61, 46, 0.7);
      display: grid;
      gap: 6px;
      box-shadow: inset 0 0 18px rgba(0, 0, 0, 0.3);
    }

    .timer-mode {
      display: flex;
      justify-content: center;
      gap: 6px;
      flex-wrap: wrap;
      font-size: 0.85rem;
      color: var(--chalk-muted);
    }

    .mode-btn {
      background: transparent;
      border: 1px solid var(--chalk-faint);
      color: var(--chalk);
      padding: 4px 8px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .mode-btn.active {
      background: rgba(244, 241, 232, 0.15);
      border-color: rgba(244, 241, 232, 0.4);
    }

    .timer-value {
      font-size: clamp(2rem, 3vw, 2.8rem);
      font-weight: 700;
      text-shadow: var(--chalk-shadow);
    }

    .timer-alert {
      font-size: 0.95rem;
      color: var(--danger);
      min-height: 18px;
    }

    .timer-controls {
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .primary-btn,
    .control-btn {
      background: var(--board-dark);
      border: 1px solid var(--chalk-faint);
      color: var(--chalk);
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
    }

    .control-btn {
      font-size: 0.9rem;
    }

    .reset-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: space-between;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      align-items: stretch;
      min-height: 320px;
    }

    .pill-column {
      display: grid;
      grid-template-rows: repeat(5, 1fr);
      gap: 12px;
    }

    .question-pill {
      border: 2px solid var(--chalk-faint);
      border-radius: 28px;
      padding: 12px 16px;
      background: var(--pill-bg);
      color: var(--chalk);
      text-align: left;
      cursor: pointer;
      display: grid;
      gap: 4px;
      min-height: 80px;
      transition: transform 0.1s ease, opacity 0.2s ease;
      box-shadow:
        0 8px 16px rgba(0, 0, 0, 0.25),
        inset 0 0 0 2px rgba(244, 241, 232, 0.4);
    }

    .question-pill:hover {
      transform: translateY(-2px);
    }

    .question-pill.used,
    .question-pill:disabled {
      opacity: 0.35;
      cursor: not-allowed;
      transform: none;
    }

    .pill-title {
      font-size: 1.2rem;
      font-weight: 700;
      text-shadow: var(--chalk-shadow);
    }

    .pill-subject {
      color: var(--chalk-muted);
      font-size: 0.95rem;
      text-shadow: var(--chalk-shadow);
    }

    .grade-1 {
      background: var(--grade-1);
    }

    .grade-2 {
      background: var(--grade-2);
    }

    .grade-3 {
      background: var(--grade-3);
    }

    .grade-4 {
      background: var(--grade-4);
    }

    .grade-5 {
      background: var(--grade-5);
    }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(5, 20, 15, 0.78);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 10;
    }

    .modal.open {
      display: flex;
    }

    .modal-content {
      width: min(880px, 100%);
      background: var(--board-dark);
      border: 1px solid var(--chalk-faint);
      border-radius: 16px;
      padding: 20px;
      display: grid;
      gap: 16px;
      box-shadow: 0 18px 30px rgba(0, 0, 0, 0.4);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .modal-title {
      font-size: 1.2rem;
      color: var(--chalk-muted);
    }

    .question-text {
      font-size: clamp(1.4rem, 2.6vw, 2.1rem);
      line-height: 1.3;
      text-shadow: var(--chalk-shadow);
    }

    .answer {
      font-size: 1.1rem;
      color: var(--chalk);
      border-top: 1px dashed var(--chalk-faint);
      padding-top: 10px;
    }

    .answer.hidden {
      display: none;
    }

    .score-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
    }

    .score-btn {
      padding: 12px;
      border-radius: 10px;
      border: 1px solid var(--chalk-faint);
      cursor: pointer;
      font-size: 1rem;
      background: rgba(15, 61, 46, 0.6);
      color: var(--chalk);
    }

    .score-btn.ra.correct {
      background: rgba(183, 245, 194, 0.2);
    }

    .score-btn.ra.wrong {
      background: rgba(255, 179, 179, 0.2);
    }

    .score-btn.fifth.correct {
      background: rgba(183, 245, 194, 0.2);
    }

    .score-btn.fifth.wrong {
      background: rgba(255, 179, 179, 0.2);
    }

    .modal-actions {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .modal-actions button {
      flex: 1 1 180px;
    }

    .close-btn {
      background: transparent;
      border: 1px solid var(--chalk-faint);
      color: var(--chalk-muted);
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
    }

    .rules-body {
      font-size: 1rem;
      line-height: 1.5;
      color: var(--chalk);
      white-space: pre-line;
    }

    .footer-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    @media (max-width: 980px) {
      .content {
        grid-template-columns: 1fr;
      }

      .board {
        grid-template-columns: 1fr;
      }

      .pill-column {
        grid-template-rows: repeat(5, auto);
      }
    }

    @media (max-width: 720px) {
      body {
        padding: 12px;
      }

      .question-pill {
        min-height: 70px;
      }

      .modal-content {
        padding: 16px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="top-row">
      <div>
        <div class="title">Are You Smarter Than a 5th Grader?</div>
        <div class="subheader">Indiana Tech RAs vs Forest Park Elementary</div>
        <div class="banner" id="roundBanner">Round 1 banner</div>
      </div>
      <div class="round-select">
        <button class="control-btn" id="rulesBtn">Show Rules</button>
        <label for="roundSelect">Round:</label>
        <select id="roundSelect"></select>
      </div>
    </div>
  </header>

  <main class="content">
    <section class="scoreboard">
      <div class="score-header">
        <strong>Team Totals</strong>
        <div class="footer-buttons">
          <button class="control-btn" id="resetRoundBtn">Reset Round</button>
          <button class="control-btn" id="resetAllBtn">Reset All</button>
        </div>
      </div>
      <div class="scores">
        <div class="score-card">
          <div class="team-name">RAs</div>
          <div class="team-score" id="raScore">0</div>
          <div class="lifelines" id="raLifelines"></div>
        </div>
        <div class="score-card">
          <div class="team-name">5th Graders</div>
          <div class="team-score" id="fifthScore">0</div>
          <div class="lifelines" id="fifthLifelines"></div>
        </div>
      </div>

      <div class="timer">
        <div class="timer-value" id="timerValue">60</div>
        <div class="timer-alert" id="timerAlert"></div>
        <div class="timer-mode" id="timerMode">
          <span>Default:</span>
          <button class="mode-btn active" data-time="60">60s</button>
          <button class="mode-btn" data-time="30">30s</button>
        </div>
        <div class="timer-controls">
          <button class="control-btn" id="timerStartBtn">Start</button>
          <button class="control-btn" id="timerPauseBtn">Pause</button>
          <button class="control-btn" id="timerResetBtn">Reset</button>
        </div>
      </div>
      <button class="control-btn" id="resetLifelinesBtn">Reset Lifelines (This Round)</button>
    </section>

    <section class="board" id="board"></section>
  </main>

  <div class="modal" id="questionModal" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="modalMeta">Grade - Subject - Points</div>
          <div class="question-text" id="modalQuestion">Question text</div>
        </div>
        <button class="close-btn" id="closeModalBtn">Close</button>
      </div>
      <button class="primary-btn" id="showAnswerBtn">Show Answer</button>
      <div class="answer hidden" id="modalAnswer"></div>
      <div class="score-buttons">
        <button class="score-btn ra correct" data-team="ra" data-delta="1">RA Correct (+points)</button>
        <button class="score-btn ra wrong" data-team="ra" data-delta="-1">RA Wrong (-points)</button>
        <button class="score-btn fifth correct" data-team="fifth" data-delta="1">5th Correct (+points)</button>
        <button class="score-btn fifth wrong" data-team="fifth" data-delta="-1">5th Wrong (-points)</button>
      </div>
      <div class="modal-actions">
        <button class="primary-btn" id="markUsedBtn">Mark Used & Close</button>
        <button class="close-btn" id="cancelModalBtn">Cancel</button>
      </div>
    </div>
  </div>

  <div class="modal" id="rulesModal" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <div>
          <div class="modal-title">Rules</div>
          <div class="question-text">Are You Smarter Than A 5th Grader?</div>
        </div>
        <button class="close-btn" id="closeRulesBtn">Close</button>
      </div>
      <div class="rules-body" id="rulesBody"></div>
    </div>
  </div>

  <script>
    const DEFAULT_TIME = 60;
    const DEFAULT_LIFELINES = { peek: 2, copy: 2 };
    const DEFAULT_RULES = `Are You Smarter Than A 5th Grader?
Indiana Tech Resident Assistants vs Forest Park Elementary
The goal: earn your team the most points by answering questions correctly!
One RA and one 5th grader are at the podium at a time. Everyone else is part of the audience and plays along. After each question, new players rotate to the podiums.
The game has two rounds. Each round has five subjects and twenty-five total questions. Questions are worth more points as they get harder.
A subject and point value are chosen by an alternating team for each question. The question is read out loud. Everyone writes their answer on a whiteboard. When finished, players ring the bell. Players may then choose to use a lifeline. Answers are revealed.
Scoring is team-based. Both podium players answer every question. Both can earn points if correct. Both can miss points if incorrect. Audience answers do not earn points, but may be used for lifelines.
Each team gets two "Peeks" and two "Copies" per round. A Peek allows a player to look at the other group's answers, including the audience or opposing team, and change their answer if needed. A Copy requires the player to copy the opposing podium player's answer exactly. If that answer is wrong, the copied answer is also wrong. Lifelines reset at the start of each round.
Answers are short, usually a word or a number. There is no partial credit. Judges' decisions are final. Write your answer first, ring the bell when ready.`;

    const QUESTIONS = [
      { label: "4th", subject: "Weather", points: 400, question: "What instrument is used by meteorologists to measure air pressure?", answer: "Barometer" },
      { label: "1st", subject: "Mathematics", points: 100, question: "What is the fewest number of coins needed to make 49 cents?", answer: "7" },
      { label: "5th", subject: "Animal Kingdom", points: 500, question: "What type of animal is a koala?", answer: "Marsupial" },
      { label: "2nd", subject: "Early Americas", points: 200, question: "Which civilization built stone cities in the Andes Mountains?", answer: "Inca" },
      { label: "3rd", subject: "Grammar", points: 300, question: "What word is the preposition in the following sentence: \"Mackenzie sang in the school musical.\"", answer: "In" },
      { label: "1st", subject: "Health", points: 100, question: "How many kidneys do most people have?", answer: "2" },
      { label: "4th", subject: "Ocean Science", points: 400, question: "Which ocean zone receives enough sunlight for photosynthesis?", answer: "Surface zone" },
      { label: "5th", subject: "Space Science", points: 500, question: "What Moon phase comes directly after a new moon?", answer: "Waxing crescent" },
      { label: "2nd", subject: "Matter", points: 200, question: "What state of matter is water vapor?", answer: "Gas" },
      { label: "3rd", subject: "Early History", points: 300, question: "What language did the Romans speak?", answer: "Latin" },
      { label: "1st", subject: "U.S. Geography", points: 100, question: "Which state has the capital city of Indianapolis?", answer: "Indiana" },
      { label: "4th", subject: "Mathematics", points: 400, question: "How many tenths are in the decimal 0.7?", answer: "7" },
      { label: "5th", subject: "Ocean Science", points: 500, question: "What is the name for the deepest parts of the ocean?", answer: "Trenches" },
      { label: "2nd", subject: "Weather", points: 200, question: "Rain, snow, and hail are all forms of what?", answer: "Precipitation" },
      { label: "3rd", subject: "Animal Kingdom", points: 300, question: "What animal class are frogs?", answer: "Amphibians" },
      { label: "5th", subject: "Grammar", points: 500, question: "What is the subordinating conjunction in the following sentence? \"They lost the competition because they didn't practice.\"", answer: "Because" },
      { label: "1st", subject: "Space Science", points: 100, question: "What force keeps the comets in orbit around the Sun?", answer: "Gravity" },
      { label: "4th", subject: "Ancient History", points: 400, question: "The Great Sphinx of Giza has the head of a man and the body of what species of animal?", answer: "A Lion" },
      { label: "2nd", subject: "Early History", points: 200, question: "What was Jonny Appleseed's real name?", answer: "John Chapman" },
      { label: "5th", subject: "Health", points: 500, question: "Where are the smallest bones in the body located?", answer: "Ear" },
      { label: "1st", subject: "Grammar", points: 100, question: "True or False? The suffix goes at the beginning of a word.", answer: "False" },
      { label: "4th", subject: "U.S. Geography", points: 400, question: "What U.S. mountain range includes Mount Mitchell", answer: "Appalachians" },
      { label: "5th", subject: "Mathematics", points: 500, question: "Which is greater: 5/8 or 0.6?", answer: "5/8" },
      { label: "3rd", subject: "Ocean Science", points: 300, question: "What is the term for a continuous movement of ocean water in one direction?", answer: "Current" },
      { label: "1st", subject: "Weather", points: 100, question: "Which process comes first: evaporation or precipitation?", answer: "Evaporation" },
      { label: "3rd", subject: "Matter", points: 300, question: "What is the scientific term for the amount of \"stuff\" or matter inside an object?", answer: "Mass" },
      { label: "2nd", subject: "U.S. Geography", points: 200, question: "Which of the 50 U.S. state capitals lies at the northernmost line of latitude?", answer: "Juneau" },
      { label: "4th", subject: "Animal Kingdom", points: 400, question: "What is it called when a reptile sheds its skin?", answer: "Molting" },
      { label: "5th", subject: "Early History", points: 500, question: "The Venetian merchant who traveled extensively in Asia along the Silk Road", answer: "Marco Polo" },
      { label: "2nd", subject: "Space Science", points: 200, question: "A moon is also referred to as a what?", answer: "Satellite" },
      { label: "1st", subject: "Early Americas", points: 100, question: "Which civilization lived in present-day Mexico?", answer: "Aztec" },
      { label: "2nd", subject: "Mathematics", points: 200, question: "You Have 20 Pairs Of Shoes, But There Is Only Room In Your Closet For Eight Shoes. How Many Pairs Of Shoes Do You Have To Get Rid Of?", answer: "16" },
      { label: "4th", subject: "Grammar", points: 400, question: "What word is the possessive noun in the following sentence?\"Mr. Davison got fed up and took Andrea's book.\"", answer: "Andrea's" },
      { label: "2nd", subject: "Ocean Science", points: 200, question: "Which ocean is larger: the Atlantic or the Pacific?", answer: "Pacific" },
      { label: "3rd", subject: "Space Science", points: 300, question: "What planet in our solar system is the seventh closest to the sun?", answer: "Uranus" },
      { label: "4th", subject: "Health", points: 400, question: "What units are used to measure the amount of energy provided by food?", answer: "Calories" },
      { label: "5th", subject: "Weather", points: 500, question: "The weather pattern that consistently occurs over many years would be considered an areas what?", answer: "Climate" },
      { label: "2nd", subject: "Animal Kingdom", points: 200, question: "Penguins cannot fly. Why are they still classified as birds?", answer: "They have feathers" },
      { label: "1st", subject: "Ancient History", points: 100, question: "What was the name of the Egyptian king who became famous after his golden tomb was found?", answer: "Tutankhamun (or King Tut)" },
      { label: "3rd", subject: "Early History", points: 300, question: "What language did the Romans speak?", answer: "Latin" },
      { label: "3rd", subject: "Weather", points: 300, question: "What is formed when water vapor cools in the atmosphere?", answer: "Clouds" },
      { label: "4th", subject: "Space Science", points: 400, question: "what is the most abundant element in the universe", answer: "Hydrogen" },
      { label: "5th", subject: "U.S. Geography", points: 500, question: "How many U.S. states border the Pacific Ocean?", answer: "5" },
      { label: "3rd", subject: "Early Americas", points: 300, question: "Which civilization is known for its advanced calendar system?", answer: "Mayans" },
      { label: "5th", subject: "Matter & Mixtures", points: 500, question: "Salt is made from which two elements?", answer: "Sodium and chlorine" },
      { label: "4th", subject: "American History", points: 400, question: "Who was the 26th U.S. President", answer: "Teddy Roosevelt" },
      { label: "3rd", subject: "Mathematics", points: 300, question: "If your mom sends you to the store for 3 gallons of ice cream but the store only sells pints, how many pints must you buy?", answer: "24" },
      { label: "1st", subject: "Health", points: 100, question: "How many kidneys do most people have?", answer: "2" },
      { label: "2nd", subject: "Earth Science", points: 200, question: "True or False: A dormant volcano is one that scientists believe will never erupt again.", answer: "False" },
      { label: "1st", subject: "Animal Kingdom", points: 100, question: "Which group do animals with fur and milk for their young belong to?", answer: "Mammals" }
    ];

    const ROUNDS = buildRounds();

    const state = {
      roundIndex: 0,
      used: {},
      scores: { ra: 0, fifth: 0 },
      lifelines: {
        ra: { ...DEFAULT_LIFELINES },
        fifth: { ...DEFAULT_LIFELINES }
      },
      timer: {
        value: DEFAULT_TIME,
        interval: null,
        running: false,
        defaultValue: DEFAULT_TIME
      },
      currentQuestion: null
    };

    const roundSelect = document.getElementById("roundSelect");
    const roundBanner = document.getElementById("roundBanner");
    const board = document.getElementById("board");
    const raScore = document.getElementById("raScore");
    const fifthScore = document.getElementById("fifthScore");
    const raLifelines = document.getElementById("raLifelines");
    const fifthLifelines = document.getElementById("fifthLifelines");
    const timerValue = document.getElementById("timerValue");
    const timerAlert = document.getElementById("timerAlert");
    const timerMode = document.getElementById("timerMode");

    const modal = document.getElementById("questionModal");
    const modalMeta = document.getElementById("modalMeta");
    const modalQuestion = document.getElementById("modalQuestion");
    const modalAnswer = document.getElementById("modalAnswer");
    const showAnswerBtn = document.getElementById("showAnswerBtn");
    const markUsedBtn = document.getElementById("markUsedBtn");
    const rulesModal = document.getElementById("rulesModal");
    const rulesBody = document.getElementById("rulesBody");

    function init() {
      roundSelect.innerHTML = "";
      ROUNDS.forEach((round, idx) => {
        const option = document.createElement("option");
        option.value = idx;
        option.textContent = round.name;
        roundSelect.appendChild(option);
      });

      roundSelect.addEventListener("change", (event) => {
        state.roundIndex = Number(event.target.value);
        resetLifelines();
        resetRoundUsed();
        renderRound();
      });

      document.getElementById("resetRoundBtn").addEventListener("click", () => {
        resetRoundUsed();
        resetTimer();
        resetLifelines();
        renderRound();
      });

      document.getElementById("resetAllBtn").addEventListener("click", () => {
        resetAll();
        renderRound();
      });

      document.getElementById("resetLifelinesBtn").addEventListener("click", resetLifelines);

      document.getElementById("timerStartBtn").addEventListener("click", startTimer);
      document.getElementById("timerPauseBtn").addEventListener("click", pauseTimer);
      document.getElementById("timerResetBtn").addEventListener("click", () => resetTimer());

      document.getElementById("closeModalBtn").addEventListener("click", closeModal);
      document.getElementById("cancelModalBtn").addEventListener("click", closeModal);
      document.getElementById("rulesBtn").addEventListener("click", openRules);
      document.getElementById("closeRulesBtn").addEventListener("click", closeRules);
      showAnswerBtn.addEventListener("click", toggleAnswer);
      markUsedBtn.addEventListener("click", markUsed);

      document.querySelectorAll(".score-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          if (!state.currentQuestion) return;
          const team = btn.dataset.team;
          const delta = Number(btn.dataset.delta);
          const points = state.currentQuestion.points * delta;
          state.scores[team] += points;
          updateScores();
        });
      });

      timerMode.querySelectorAll(".mode-btn").forEach((btn) => {
        btn.addEventListener("click", () => setTimerMode(Number(btn.dataset.time)));
      });

      rulesBody.textContent = DEFAULT_RULES;
      renderRound();
      updateScores();
      updateLifelines();
      updateTimerDisplay();
    }

    function buildRounds() {
      const gradeOrder = ["5th", "4th", "3rd", "2nd", "1st"];
      const grouped = gradeOrder.reduce((acc, grade) => {
        acc[grade] = QUESTIONS.filter((q) => q.label === grade);
        shuffle(acc[grade]);
        return acc;
      }, {});
      const rounds = [];
      for (let i = 0; i < 5; i += 1) {
        const setA = [];
        const setB = [];
        gradeOrder.forEach((grade) => {
          const first = grouped[grade].pop();
          const second = grouped[grade].pop();
          if (Math.random() > 0.5) {
            setA.push(first);
            setB.push(second);
          } else {
            setA.push(second);
            setB.push(first);
          }
        });
        rounds.push({
          name: `Round ${i + 1}`,
          banner: `Round ${i + 1} - Mixed Categories`,
          setA,
          setB
        });
      }
      return rounds;
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function renderRound() {
      const round = ROUNDS[state.roundIndex];
      roundSelect.value = state.roundIndex;
      roundBanner.textContent = round.banner;
      board.innerHTML = "";

      const leftColumn = createColumn(round.setA, "A");
      const rightColumn = createColumn(round.setB, "B");

      board.appendChild(leftColumn);
      board.appendChild(rightColumn);
    }

    function gradeClassFromLabel(label) {
      const map = { "1st": "grade-1", "2nd": "grade-2", "3rd": "grade-3", "4th": "grade-4", "5th": "grade-5" };
      return map[label] || "";
    }

    function createColumn(questions, setLabel) {
      const column = document.createElement("div");
      column.className = "pill-column";

      questions.forEach((q, idx) => {
        const pill = document.createElement("button");
        pill.className = "question-pill";
        const gradeClass = gradeClassFromLabel(q.label);
        if (gradeClass) {
          pill.classList.add(gradeClass);
        }
        const usedKey = `${state.roundIndex}-${setLabel}-${idx}`;
        if (state.used[usedKey]) {
          pill.classList.add("used");
          pill.disabled = true;
        }
        pill.innerHTML = `
          <div class="pill-title">${q.label} - ${q.points} pts</div>
          <div class="pill-subject">${q.subject}</div>
        `;
        pill.addEventListener("click", () => openQuestion(setLabel, idx));
        column.appendChild(pill);
      });

      return column;
    }

    function openQuestion(setLabel, idx) {
      const round = ROUNDS[state.roundIndex];
      const questions = setLabel === "A" ? round.setA : round.setB;
      const question = questions[idx];
      state.currentQuestion = { ...question, setLabel, idx };

      modalMeta.textContent = `${question.label} - ${question.subject} - ${question.points} pts`;
      modalQuestion.textContent = question.question;
      modalAnswer.textContent = `Answer: ${question.answer}`;
      modalAnswer.classList.add("hidden");
      showAnswerBtn.textContent = "Show Answer";
      modal.classList.add("open");
      modal.setAttribute("aria-hidden", "false");
      resetTimer(true);
    }

    function openRules() {
      rulesModal.classList.add("open");
      rulesModal.setAttribute("aria-hidden", "false");
    }

    function closeRules() {
      rulesModal.classList.remove("open");
      rulesModal.setAttribute("aria-hidden", "true");
    }

    function toggleAnswer() {
      if (modalAnswer.classList.contains("hidden")) {
        modalAnswer.classList.remove("hidden");
        showAnswerBtn.textContent = "Hide Answer";
      } else {
        modalAnswer.classList.add("hidden");
        showAnswerBtn.textContent = "Show Answer";
      }
    }

    function markUsed() {
      if (!state.currentQuestion) return;
      const { setLabel, idx } = state.currentQuestion;
      const usedKey = `${state.roundIndex}-${setLabel}-${idx}`;
      state.used[usedKey] = true;
      closeModal();
      renderRound();
      pauseTimer();
    }

    function closeModal() {
      modal.classList.remove("open");
      modal.setAttribute("aria-hidden", "true");
      state.currentQuestion = null;
    }

    function updateScores() {
      raScore.textContent = state.scores.ra;
      fifthScore.textContent = state.scores.fifth;
    }

    function resetRoundUsed() {
      Object.keys(state.used)
        .filter((key) => key.startsWith(`${state.roundIndex}-`))
        .forEach((key) => delete state.used[key]);
    }

    function resetAll() {
      state.used = {};
      state.scores = { ra: 0, fifth: 0 };
      resetLifelines();
      resetTimer();
      updateScores();
    }

    function updateLifelines() {
      raLifelines.innerHTML = renderLifelineControls("ra");
      fifthLifelines.innerHTML = renderLifelineControls("fifth");
      bindLifelineButtons();
    }

    function renderLifelineControls(team) {
      const lifeline = state.lifelines[team];
      return `
        <div class="lifeline-row">
          <strong>Peek</strong>
          <span>${lifeline.peek}</span>
          <button class="small-btn" data-team="${team}" data-type="peek" data-action="use">Use</button>
          <button class="small-btn" data-team="${team}" data-type="peek" data-action="undo">Undo</button>
        </div>
        <div class="lifeline-row">
          <strong>Copy</strong>
          <span>${lifeline.copy}</span>
          <button class="small-btn" data-team="${team}" data-type="copy" data-action="use">Use</button>
          <button class="small-btn" data-team="${team}" data-type="copy" data-action="undo">Undo</button>
        </div>
      `;
    }

    function bindLifelineButtons() {
      document.querySelectorAll(".small-btn").forEach((btn) => {
        const team = btn.dataset.team;
        const type = btn.dataset.type;
        const action = btn.dataset.action;
        const current = state.lifelines[team][type];
        btn.disabled = action === "use" ? current <= 0 : current >= DEFAULT_LIFELINES[type];

        btn.addEventListener("click", () => {
          if (action === "use" && state.lifelines[team][type] > 0) {
            state.lifelines[team][type] -= 1;
          }
          if (action === "undo" && state.lifelines[team][type] < DEFAULT_LIFELINES[type]) {
            state.lifelines[team][type] += 1;
          }
          updateLifelines();
        });
      });
    }

    function resetLifelines() {
      state.lifelines = {
        ra: { ...DEFAULT_LIFELINES },
        fifth: { ...DEFAULT_LIFELINES }
      };
      updateLifelines();
    }

    function updateTimerDisplay() {
      timerValue.textContent = state.timer.value;
      timerAlert.textContent = state.timer.value === 0 ? "Time!" : "";
    }

    function startTimer() {
      if (state.timer.running) return;
      state.timer.running = true;
      state.timer.interval = setInterval(() => {
        if (state.timer.value > 0) {
          state.timer.value -= 1;
        }
        if (state.timer.value === 0) {
          pauseTimer();
        }
        updateTimerDisplay();
      }, 1000);
    }

    function pauseTimer() {
      state.timer.running = false;
      clearInterval(state.timer.interval);
      state.timer.interval = null;
    }

    function resetTimer(force) {
      if (force || !state.timer.running) {
        state.timer.value = state.timer.defaultValue;
        updateTimerDisplay();
      }
    }

    function setTimerMode(seconds) {
      state.timer.defaultValue = seconds;
      timerMode.querySelectorAll(".mode-btn").forEach((btn) => {
        btn.classList.toggle("active", Number(btn.dataset.time) === seconds);
      });
      resetTimer(true);
    }

    window.addEventListener("keydown", (event) => {
      if (event.key === "Escape") {
        if (modal.classList.contains("open")) {
          closeModal();
        }
        if (rulesModal.classList.contains("open")) {
          closeRules();
        }
      }
    });

    init();
  </script>
</body>
</html>
